<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Vehicle Parking System- User Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard_user_style.css') }}">
</head>
<body>
 
        <nav class="navbar">
        <div class="navbar-left">
            <span class="brand">Vehicle Parking System</span>
            
                <a href="{{ url_for ('main.user_dashboard',id=user_data.id) }}" class="nav-link active">Home</a>
                <a href="{{ url_for('main.user_summary',user_id=user_data.id) }}" class="nav-link">Summary</a>
            
        </div>
        <div class="navbar-right">
            <a href="{{ url_for('main.edit_profile',user_id=id )}}" class="welcome" title="Click to edit profile">Welcome, {{ name }}</a>

          <a href="{{ url_for('main.logout') }}" class="logout-btn">Logout</a>
    
        </div>
        </nav>

    
    <main>
        <section class="history-section">
            <h2>Recent parking history</h2>
            <table class="stylish-table">
                <thead>
                    <tr>
                        <th>Booking ID</th>
                        <th>Parking Lot name</th>
                        <th> Lot charge</th>
                        <th>Spot ID</th>
                        <th>Vehicle Number</th>
                        <th>Start Timestamp</th>
                        <th>Total Charges</th>
                        <th>Action</th>
                       
                    </tr>
                </thead>
                <tbody>

                   {% if booking_data %}
                        {% for booking_id in booking_data %}
                        <tr>
                            <td>{{ booking_id }}</td>
                            <td>{{ booking_data[booking_id].lot_name }}</td>
                            <td>${{ booking_data[booking_id].lot_charge }} / hr</td>
                            <td>{{ booking_data[booking_id].spot_id }}</td>
                            <td>{{  booking_data[booking_id].vehicle_number }}</td>
                            <td>{{  booking_data[booking_id].start_time }}</td>
                            <td>${{ booking_data[booking_id].total_charges }}</td>

                            {% if booking_data[booking_id].current_status=="active" %}
                            <td><button class="book-btn" onclick="window.location.href='{{ url_for('main.release_spot', user_id=user_data.id, parking_lot_id=booking_data[booking_id].lot_id,spot_id=booking_data[booking_id].spot_id) }}'">Release</button></td>
                            {% endif %}
                        </tr>
                        {% endfor %}
                    {% else %}
                    <tr><td colspan="4">No booking data available.</td></tr>
                    {% endif %}
                </tbody>

            </table>
        </section>
        <section class="search-section">
            <form action="{{ url_for('main.user_dashboard', id=user_data.id) }}" method="post">
            <label for="search">Search parking @location/pin code:</label>
            <input type="text" id="search_location" name="search_location" placeholder="Search..." 
            pattern="^[a-zA-Z0-9\s]+$"
            title="Only letters, numbers, and spaces allowed.">
            <button type="submit">Search</button>
            </form>
        </section>
        <section class="lots-section">
            <h2>Parking Lots </h2>
            
            <table class="stylish-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Parking Lot Name</th>
                        <th>Available Spots</th>
                        
                        <th>Lot Address</th>
                        <th> Lot Charge</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% if parking_data %}
                    
                            {% for lot_id, location in parking_data.items() %}
                                <tr>
                                    <td>{{ lot_id }}</td>
                                    <td>{{ location.lot_name }}</td>
                                    <td>{{ location.available_spots }}</td>

                                    <td>{{ location.lot_address }}</td>
                                    <td>${{ location.lot_charge }} / hr</td>
                                    <td>
                                        <button class="book-btn" onclick="window.location.href='{{ url_for('main.book_spot', user_id=user_data.id, parking_lot_id=lot_id) }}'">Book</button>
                                    </td>                   
                                </tr>
                            {% endfor %}
                    {% else %}
                        <tr><td colspan="4">No parking data available.</td></tr>
                    {% endif %}
                    
                </tbody>
            </table>
        </section>
    </main>
</body>

{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, message in messages %}
      <div class="alert {{ category }}">{{ message }}</div>
    {% endfor %}
  {% endif %}
{% endwith %}

<script>
    function validateSearch() {
      const input = document.getElementById("search_location").value;
      const invalidChars = /[*"']/g;
      if (invalidChars.test(input)) {
        alert("Please avoid using *, \", or ' in your search.");
        return false;
      }
      return true;
    }

 
  </script>
</html>
